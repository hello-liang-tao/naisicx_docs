🌟11.Arduino 超声波测距🌟
===================================

🎯 HC-SD04超声波
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

超声波模块利用声波的反射原理，声波发射器发射10us的超声波，声波被被测物体反射到超声波接收器，根据声音的速度340m/s，以及发射到反射回来的时间差，可以计算模块到被测物体的距离。

HC-SD04超声波最大可测量6m的距离，最短可以测量2cm的距离。

.. figure:: ../media/超声波.png
   :alt: SG90舵机
   :align: center

-----------------------------------

🎯 测量流程
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

模块TRIG管脚低电平持续10us，触发发射器发射8个40KHZ的超声波脉冲，同时ECHO管脚输出高电平。当接收器接收到超声波信号时候ECHO变为低电平，此时高电平持续时间就是声波往返时间。


🎯 测量程序
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

程序中使用 :guilabel:`pulseIn()` 函数来获取高电平持续时间。 默认ECHO低电平，发射脉冲时开始输出高电平直到接收到脉冲信号输出低电平。这个高电平持续时间通过pulseIn()函数读取。pulseIn()函数第一个参数时使用哪个管脚来接收电平信号，第二个参数是记录高电平时间还是低电平时间，单位是ms。

.. figure:: ../media/超声波接线.png
   :alt: SG90舵机
   :align: center

-----------------------------------

.. literalinclude:: ./../code/11.ultrasound/11.ultrasound.ino
   :caption: 10.servo.ino
   :language: c++
   :linenos:
   :name: 10.servo.ino
=======
超声波传感器利用中学物理知识，声波在空气中传播速度大约340m/s，因此计算发射到接收在空中飞行时间，将飞行时间的一半乘以声波速度，就可以得到超声波传感器到障碍物的位置

🚀准备知识

话不多说上图



📝编写代码

.. code-block:: c
   :caption: 定义一个浮点型变量
   :linenos:

    #define TRIG_PIN 2                  //触发产生超声波
    #define ECHO_PIN 3                  //输出产生超声波到接收反射超声波持续时间
    float distance;                     //转换为厘米长度

    /*
    * TRIG引脚输出高电平产生超声波，持续10us即可
    * ECHO引脚输入高电平时间t即为产生超声波到接收反射超声波持续时间
    * 由光速s为340m/s,换算为34cm/1000us
    * distance = (t*s)/2=(t*17)/1000;
    */
    float ping() {
      digitalWrite(TRIG_PIN,  HIGH);    //触发产生超声波
      delayMicroseconds(10);            //持续10us,10us为了产生超声波信号，不参于计算        
      digitalWrite(TRIG_PIN, LOW);      //停止超声波
      return float( pulseIn(ECHO_PIN, HIGH) * 17 ) / 1000; 
    }

    void setup()  {
      pinMode(TRIG_PIN, OUTPUT);        //初始化对于引脚
      pinMode(ECHO_PIN, INPUT);         //初始化对于引脚
      Serial.begin(9600);               //设置串口打印波特率为9600
    }

    void loop() {
      distance = ping();               //调用函数测量距离
      Serial.print("distance=");       //打印数据
      Serial.print(distance);
      Serial.println("cm");
      delay(1000);                     //间隔1s打印一次
    }


#### 👍上传代码

上传代码，点击![在这里插入图片描述](https://img-blog.csdnimg.cn/20210112154447766.png#pic_center)
打开串口监视




